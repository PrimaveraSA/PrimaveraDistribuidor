<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta name="activity-endpoint" content="https://server-py-19va.onrender.com/actividad">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://esm.sh; connect-src 'self' https: https://v2.convertapi.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://esm.sh https://pivuyofhmnbtomjizrfg.supabase.co; font-src 'self' https://cdn.jsdelivr.net; base-uri 'self'; form-action 'self';">
  <title>Dashboard de Herramientas</title>
  <link rel="icon" href="img/IconoLogo.png" type="image/png">

  <!-- Bootstrap 5 -->
  <link href="lib/bootstrap-5.3.3-dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="lib/bootstrap-icons-1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<!-- Librerías específicas -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>

  <script defer src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <script defer src="lib/exceljs.min.js"></script>
  <script defer src="lib/jspdf/dist/jspdf.umd.min.js"></script>
  <script defer src="lib/jszip/dist/jszip.min.js"></script>
  <script defer src="lib/jspdf-autotable/dist/jspdf.plugin.autotable.min.js"></script>
  <script defer src="lib/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>

  <!-- CSS personalizado -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body class="d-flex flex-column min-vh-100">

  <!-- NAVBAR -->
  <nav class="navbar navbar-dark bg-primary fixed-top shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <i class="bi bi-tools me-2"></i> Panel de Herramientas
      </a>

      <a href="http://3.14.212.129/" target="_blank" rel="noopener noreferrer" class="text-light text-decoration-none me-3 d-none d-md-block">
        Ir al sitio principal <i class="bi bi-box-arrow-up-right ms-1"></i>
      </a>

      <button id="toggleSidebarBtn" class="btn btn-sm btn-outline-light d-md-none" aria-label="Toggle Sidebar">
        <i class="bi bi-list"></i>
      </button>
    </div>
  </nav>

  <!-- SIDEBAR -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header d-flex align-items-center">
      <div class="sidebar-icon-container">
        <img src="img/IconoLogo.png" alt="Logo" class="sidebar-logo" loading="lazy">
      </div>
      <span class="sidebar-title fw-semibold">Dashboard</span>
    </div>

    <ul class="nav flex-column nav-pills" role="menu">
      <li class="nav-item">
        <a href="#" class="nav-link active d-flex align-items-center" data-tool="inicio">
          <i class="bi bi-house-door"></i><span>Inicio</span>
        </a>
      </li>
      <li class="nav-item">
        <div class="d-flex justify-content-between align-items-center">
          <a href="#" class="nav-link d-flex align-items-center flex-grow-1 header-toggle" aria-expanded="false">
            <i class="bi bi-cash-coin"></i><span>Gestión de Precios</span>
          </a>
          <button class="btn btn-sm btn-link text-light collapse-toggle" aria-expanded="false" aria-label="Toggle Submenu">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
        <ul class="nav flex-column submenu" style="display:none;">
          <li class="nav-item">
            <a href="#" class="nav-link d-flex align-items-center" data-tool="controlPreciosComparacion">
              <i class="bi bi-sliders"></i><span>Comparación de Precios</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link d-flex align-items-center" data-tool="controlPreciosPorcentajes">
              <i class="bi bi-percent"></i><span>Ajustes por Porcentajes</span>
            </a>
          </li>
          
        </ul>
      </li>
      <li class="nav-item">
        <div class="d-flex justify-content-between align-items-center">
          <a href="#" class="nav-link d-flex align-items-center flex-grow-1 header-toggle" aria-expanded="false">
            <i class="bi bi-clipboard-data"></i><span>Registros y Reportes</span>
          </a>
          <button class="btn btn-sm btn-link text-light collapse-toggle" aria-expanded="false" aria-label="Toggle Submenu">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
        <ul class="nav flex-column submenu" style="display:none;">
          <li class="nav-item">
            <a href="#" class="nav-link d-flex align-items-center" data-tool="controlFacturacion">
              <i class="bi bi-journal-text"></i><span>Control de Registros</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <div class="d-flex justify-content-between align-items-center">
          <a href="#" class="nav-link d-flex align-items-center flex-grow-1 header-toggle" aria-expanded="false">
            <i class="bi bi-filetype-xlsx"></i><span>Conversión a Excel</span>
          </a>
          <button class="btn btn-sm btn-link text-light collapse-toggle" aria-expanded="false" aria-label="Toggle Submenu">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
        <ul class="nav flex-column submenu" style="display:none;">
          <li class="nav-item">
            <a href="#" class="nav-link d-flex align-items-center" data-tool="conversorAExcel">
              <i class="bi bi-filetype-pdf"></i><span>PDF a Excel</span>
            </a>
          </li>
        </ul>
      </li>
      <li class="nav-item">
        <div class="d-flex justify-content-between align-items-center">
          <a href="#" class="nav-link d-flex align-items-center flex-grow-1 header-toggle" aria-expanded="false">
            <i class="bi bi-box-seam"></i><span>Inventario y Stock</span>
          </a>
          <button class="btn btn-sm btn-link text-light collapse-toggle" aria-expanded="false" aria-label="Toggle Submenu">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
        <ul class="nav flex-column submenu" style="display:none;">
          <li class="nav-item">
            <a href="#" class="nav-link d-flex align-items-center" data-tool="gestionPrecios">
              <i class="bi bi-bar-chart"></i><span>Comparar Stock</span>
            </a>
          </li>
        </ul>
      </li>
    </ul>

    <div class="keepalive-container">
      <button id="keepaliveBtn" class="keepalive-btn" aria-label="Mantener activo">
        <i class="bi bi-activity"></i>
        <span class="keepalive-label">Mantener activo</span>
      </button>
    </div>
  </aside>
  <div id="sidebarOverlay" class="sidebar-overlay d-md-none" aria-hidden="true"></div>

  <!-- CONTENIDO PRINCIPAL -->
  <main id="main-content" class="main-content flex-grow-1">
    <div class="container-fluid pt-3">

      <div id="inicio-content">
        <h3 class="fw-bold" style="color: #07436b;">¡Bienvenido a Herramientas Primavera!</h3>
        <p class="text-muted fs-6 mb-0">Selecciona una herramienta en el panel lateral para comenzar.</p>
      </div>

      <div id="tool-title-container"></div>

      <div id="iframe-container_principal" class="mt-3 card p-3 shadow-sm">

        <!-- Encabezado -->
        <div class="text-center py-4">
          <i class="bi bi-gear-wide-connected display-4 text-primary mb-2"></i>
          <h4 class="fw-semibold mb-1">Centro de Herramientas</h4>
          <p class="text-muted mb-0">
            Utilidades complementarias para apoyar la gestión y mantenimiento de la plataforma Primavera.
          </p>
        </div>

        <hr class="my-4">

        <!-- Tarjetas principales -->
        <div class="row g-4 mb-4">
          <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 p-3 text-center">
              <i class="bi bi-wrench-adjustable-circle display-5 text-primary mb-3"></i>
              <h5 class="fw-semibold">Herramientas Disponibles</h5>
              <p class="text-muted small mb-0">
                Accede a los diferentes módulos para registrar o apoyarse en actividades manuales
              </p>
            </div>
          </div>

          <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 p-3 text-center">
              <i class="bi bi-journal-text display-5 text-success mb-3"></i>
              <h5 class="fw-semibold">Documentación</h5>
              <p class="text-muted small mb-0">
                Sin documentacion por el momento.
              </p>
            </div>
          </div>

          <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100 p-3 text-center">
              <i class="bi bi-headset display-5 text-danger mb-3"></i>
              <h5 class="fw-semibold">Soporte Técnico</h5>
              <p class="text-muted small mb-0">
                Contacta con el área técnica o reporta incidencias directamente desde la plataforma.
              </p>
            </div>
          </div>
        </div>

        <!-- Novedades y estado -->
        <div class="row g-4 align-items-stretch">
          <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 p-3">
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-megaphone-fill text-warning fs-3 me-2"></i>
                <h6 class="fw-semibold mb-0">Novedades Recientes</h6>
              </div>
              <ul class="list-unstyled mb-0 small text-muted">
                <li class="mb-2"><i class="bi bi-dot text-primary"></i> Mejoras y Optimización Generales</li>
                <li class="mb-2"><i class="bi bi-dot text-primary"></i> Optimización del módulo PDF → Excel.</li>
                <li class="mb-2"><i class="bi bi-dot text-primary"></i> Nueva interfaz de gestión de precios.</li>
                <li class="mb-2"><i class="bi bi-dot text-primary"></i> Mejoras en compatibilidad móvil.</li>
              </ul>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100 p-3">
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-cloud-check-fill text-info fs-3 me-2"></i>
                <h6 class="fw-semibold mb-0">Estado del Sistema</h6>
              </div>
              <ul class="list-unstyled mb-0 small text-muted">
                <li class="mb-2"><i class="bi bi-server text-secondary me-1"></i> Servidores Operativos: <strong id="servidoresStatus">Verificando...</strong></li>
                <li id="toolsStatusItem" class="mb-2">
                  <i id="toolsStatusIcon" class="bi bi-check-circle text-success me-1"></i>
                  <span id="toolsStatus">Todas las herramientas activas.</span>
                </li>
                <li class="mb-2"><i class="bi bi-clock-history text-secondary me-1"></i> Última actualización: <strong id="fechaActual"></strong>
                <li class="mb-2"><i class="bi bi-clock text-secondary me-1"></i> Hora actual: <strong id="horaActual"></strong></li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Bloque soporte rápido -->
        <div class="mt-4 p-4 bg-light rounded-3 border text-center">
          <i class="bi bi-life-preserver text-primary fs-2 mb-2"></i>
          <p class="mb-1 fw-semibold">¿Necesitas ayuda rápida?</p>
          <p class="text-muted small mb-2">
            Comunícate con soporte técnico o revisa la guía de resolución de errores comunes.
          </p>
          <span class="badge bg-primary-subtle text-primary rounded-pill px-3 py-2">
            primaveradistribuidores@gmail.com
          </span>
        </div>

        <hr class="my-4">

        <!-- Pie -->
        <div class="text-center text-muted small">
          <i class="bi bi-info-circle me-1"></i>
          Este panel forma parte de las herramientas internas de <strong>Primavera Distribuidores S.A.C.</strong>.<br>
          Usa el menú lateral para acceder a cada módulo según tus necesidades.
        </div>
      </div>

      <div id="iframe-container" class="mt-3 card p-3 shadow-sm">
        <!-- Aquí se cargará la herramienta seleccionada -->
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="main-footer text-sm bg-light text-muted d-flex justify-content-between align-items-center flex-wrap">
    <div class="footer-left">
      &copy; 2026 <a href="http://primaveraperu.pe">Primavera Distribuidores S.A.C.</a> Todos los derechos reservados.
    </div>
    <div class="footer-right">
      By. Primavera — Versión 0.50
    </div>
  </footer>

  <!-- Modal conexión -->
  <div id="conexionModal">
    <div class="modal-content">
      <h3 id="modalTitulo">⚠ Conexión Fallida</h3>
      <p id="modalMensaje">Tu conexión a internet se ha perdido.</p>
      <button id="recargarBtn">Recargar</button>
    </div>
  </div>

  <!-- Toast conexión -->
  <div id="toastConexion" class="toast-connection success" style="display:none;">
    <div class="toast-icon">✅</div>
    <div class="toast-message">Conexión restablecida</div>
    <button class="toast-close">&times;</button>
  </div>

  <!-- Modal global conversor -->
  <div class="modal fade conv_modal" id="conv_confirmModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content conv_modal-content border-0 shadow-lg">
        <div class="modal-header bg-success text-white conv_modal-header">
          <h5 class="modal-title conv_modal-title">
            <i class="bi bi-check2-circle me-2"></i> Confirmar conversión
          </h5>
        </div>
        <div class="modal-body conv_modal-body">
          <p class="mb-0">¿Deseas convertir este archivo PDF a formato Excel (.xlsx)?</p>
        </div>
        <div class="modal-footer conv_modal-footer">
          <button id="conv_confirmYes" type="button" class="btn btn-success conv_btn-yes">
            <i class="bi bi-check-circle me-1"></i> Sí, convertir
          </button>
          <button id="conv_confirmNo" type="button" class="btn btn-outline-secondary conv_btn-no" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-1"></i> Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script defer src="lib/supabase.min.js"></script>
  <script type="module" src="js/activity-ping.js"></script>
  <script defer src="js/main.js"></script>
  <script defer src="tools/gestion-precios/gestion_precios.js"></script>
  <script defer src="tools/conversor-a-excel/conversor.js"></script>
  <script type="module" src="tools/control-facturacion/control_facturacion.js"></script>

</body>
</html>
